\section{Gerät Aufbau}

\subsection{CAD-Baugruppe}

Das Gerät wurde im CAD modelliert. In der CAD-Baugruppe wurden neben den selber konstruierten Teilen und Normteilen auch die Motoren und Elektronik Komponenten dargestellt. Elektronische Komponenten wie beispielsweise der Controller, Kamera oder Sensoren wurden mithilfe von Vorlagen\footnote{\url{https://grabcad.com/}} in die Baugruppe  integriert. In der Abbildung \ref{fig:CADohneHaube1} ist die CAD-Baugruppe seitlich von vorne zusehen und in der Abbildung \ref{fig:CADohneHaube2} seitlich von hinten. Bei beiden Bildern ist das Gerät ohne Haube dargestellt, um den inneren Aufbau ersichtlich zu machen. Eine Abbildung des CAD-Modells der Haube ist im Kapitel \ref{subsec:Komponenten} am Ende zu finden.

\begin{figure}[H]
  \includegraphics[width=0.9\textwidth]{img/Gerät Aufbau/CADohneHaube1.png}
  \centering
  \caption{CAD-Modell, Ansicht 1}
  \label{fig:CADohneHaube1}
\end{figure}

\begin{figure}[H]
  \includegraphics[width=0.9\textwidth]{img/Gerät Aufbau/CADohneHaube2.png}
  \centering
  \caption{CAD-Modell, Ansicht 2}
  \label{fig:CADohneHaube2}
\end{figure}

\subsection{Aufgebautes Gerät}

Die Abbildung \ref{fig:GerätohneHaube} zeigt das aufgebaute Gerät ohne Haube und in der Abbildung \ref{fig:GerätmitHaube} ist das Gerät mit Haube zu sehen. 

\newpage

\begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/Gerät Aufbau/GerätohneHaube.png}
  \centering
  \caption{Gerät ohne Haube (Bild aktualisieren wenn fertig)}
  \label{fig:GerätohneHaube}
\end{figure}

\begin{figure}[H]
  \includegraphics[width=0.7\textwidth]{img/Gerät Aufbau/GerätmitHaube.png}
  \centering
  \caption{Gerät mit Haube (Bild aktualisieren wenn fertig)}
  \label{fig:GerätmitHaube}
\end{figure}

\newpage

\subsection{Komponenten}
\label{subsec:Komponenten}

\textbf{Grundplatte:} Die Grundplatte besteht aus zwei 3D-gedruckten Platten, die zusammengesteckt und verklebt sind. Die notwendigen Bohrungen für Schrauben konnten direkt mitgedruckt werden. Die Halterungen für die Fortbewegungsmotoren sind in die Grundplatte integriert.

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Grundplatte.png}
  \centering
  \caption{Grundplatte}
  \label{fig:Grundplatte}
\end{figure}

\textbf{Wellen:} Die Wellen des Gerätes wurden von der mechanischen Werkstatt der Hochschule gefertigt. Sie sind aus Aluminium. Von den 10 Stunden, welche für die Fertigung in der mechanischen Werkstatt zur Verfügung stehen, wurden 6.5 Stunden für die drei Wellen gebraucht. Die Auslegerwelle wurde jedoch wieder durch eine Kunststoff Welle ersetzt. Dieser Austausch ist im Kapitel \ref{sec:Funktionsweisemit Akku} dokumentiert.

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Wellen.png}
  \centering
  \caption{unten: Welle 1, mitte: Welle 2, oben: Auslegerwelle}
  \label{fig:Wellen}
\end{figure}

\newpage

\textbf{Lagerung der Grundkörperwellen:} An die Grundplatte sind hinten an den Seiten zwei Lagerböcke geschraubt, welche die zwei Wellen (Welle 1 und Welle 2), die durch den Grundkörper verlaufen, aufnehmen. Ein Lagerbock ist so gestaltet, dass die zwei Lager fest sind (Festlager) und der andere so, dass sich die Lager im Lagerbock verschieben können (Loslager). Somit sind die Wellen 1 und 2 statisch bestimmt gelagert. Der Festlagerbock ist in der Abbildung \ref{fig:Festlager} zu sehen. Der Loslagerbock ist identisch aufgebaut, nur können sich die Lager axial verschieben.

\begin{figure}[H]
  \includegraphics[width=0.7\textwidth]{img/Gerät Aufbau/Lagerböcke.png}
  \centering
  \caption{hinten rechts: Festlager, vorne links: Loslager}
  \label{fig:Lagerung}
\end{figure}

\begin{figure}[H]
  \includegraphics[width=0.5\textwidth]{img/Gerät Aufbau/Festlager.png}
  \centering
  \caption{Lagerbock als Festlager}
  \label{fig:Festlager}
\end{figure}

\newpage

\textbf{Halterung des Hubmotors:} Die Halterung des Hubmotors (siehe Abbildung \ref{fig:Lagerung}) ist 3D-gedruckt. Bei der Halterung ist der Motor mit M3-Schrauben befestigt. Zusätzlich liegt der Motor mantelseitig in der Halterungen auf, um den Motor möglichst stabil halten zu können. Die Halterung ist von unten an die Grundplatte geschraubt.

\textbf{Zahnräder:} Alle Zahnräder, die im Gerät verbaut sind, sind 3D-gedruckt. Tests haben gezeigt, dass die Zahnräder die Belastung aushalten. Dies hat die Vorteile, dass zum einen Gewicht und zum anderen Kosten gespart werden können. Das seitliche Gewinde, das die Zahnräder aufweisen, um mit einer Schraube die axiale Verschiebung zu verhindern, ist mit einer eingesetzten Mutter realisiert (siehe Abbildung \ref{fig:Zahnräder}). Dies ist so gemacht, damit die Innengewinde eine genügend grosse Festigkeit aufweisen. Die Spezifikationen der Zahnräder sind im Anhang unter Kapitel Zahnräder und Zahnriemen zu finden.

\begin{figure}[H]
  \includegraphics[width=0.9\textwidth]{img/Gerät Aufbau/Zahnräder.png}
  \centering
  \caption{Zahnräder}
  \label{fig:Zahnräder}
\end{figure}

\textbf{Fortbewegung:} Für die Fortbewegung wurden zwei Modellbauräder eingekauft. Die Räder haben einen Durchmesser von 65 mm und sind 32 mm breit. Die Räder sind über ein Verbindungsstück aus Messing mit den Antriebswellen der Fortbewegungsmotoren verbunden. Das Messingstück hat einen Aussensechskant und die Räder einen Innensechskannt. Mit einer Schraube werden die Räder an den Verbindungsstücken gehalten und die Sechskantformverbindung stellt die Mitnahme bei der Drehung sicher. Die Verbindungsstücke sind auf die Motorwellen gesteck und eine seitliche Schraube, die auf die Freifläche der Motorwelle drückt ist für die Mitnahme bei der Drehung zuständig. In der Abbildung \ref{fig:Komponenten der Fortbewegung} sind die Komponenten der Fortbewegung zu sehen und in der Abbildung \ref{fig:Räder an Fortbewegungsmotoren} sind die Räder an die Motoren geschraubt.

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Räder zerlegt.png}
  \centering
  \caption{Komponenten der Fortbewegung}
  \label{fig:Komponenten der Fortbewegung}
\end{figure}

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Räder mit Motor.png}
  \centering
  \caption{Räder an Fortbewegungsmotoren}
  \label{fig:Räder an Fortbewegungsmotoren}
\end{figure}

\newpage

\textbf{Ausleger:} Die seitlichen zwei Ausleger bestehen jeweils aus einer Verbindungsleiste und einem Standfuss. Sie sind über die Auslegerwelle miteinander verbunden.

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Ausleger.png}
  \centering
  \caption{Ausleger}
  \label{fig:Ausleger}
\end{figure}

\textbf{Verbindungsleisten:} Die Verbindungsleisten bestehen aus einer Leiste, einem angeschraubten Flansch und angeschraubten Führungen. Die Komponenten der Verbindungsleisten sind 3D-gedruckt.

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Verbindungsleisten.png}
  \centering
  \caption{Verbindungsleisten mit angeschraubten Flanschen}
  \label{fig:Verbindungsleisten}
\end{figure}

\textbf{Standfüsse:} Die Standfüsse bestehen aus einem Blech und einem angeschraubten Flansch. Der Flansch ist identisch wie dieser, der bei den Verbindungsleisten eingesetzt ist. Die Standfüsse sind 3D-gedruckt.

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Standfüsse.png}
  \centering
  \caption{Standfüsse}
  \label{fig:Standfüsse}
\end{figure}

\newpage

\textbf{Auslegerwelle:} Auf der Auslegerwelle (siehe Abbildung \ref{fig:Auslegerwelle}), die 3D-gedruckt ist, sind auf beiden Seiten die Abtriebsräder der Zahnriemen aufgesteckt. Sie besitzen eine Passfederverbindung. Weiter sind die Aufnahmestücke der Verbindungsleisten, die drehbar auf der Welle sitzen, aufgesteckt. Diese Aufnahmestücke enthalten in der Mitte ein Lager, was in der Abbildung \ref{fig:Aufnahmestück} zu sehen ist.

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Auslegerwelle.png}
  \centering
  \caption{Auslegerwelle}
  \label{fig:Auslegerwelle}
\end{figure}

\begin{figure}[H]
  \includegraphics[width=0.5\textwidth]{img/Gerät Aufbau/Aufnahmestück.png}
  \centering
  \caption{Auslegerwelle-Aufnahmestück}
  \label{fig:Aufnahmestück}
\end{figure}

\newpage

\textbf{Zahnriementrieb:} Die Zahnriemen sind auf beiden Seiten des Geräts zwischen der Welle 1 und der Auslegerwelle gespannt. Das treibende Zahnriemenrad sitzt drehbar auf der Welle 1 und das getriebene Zahnriemenrad ist auf der Auslegerwelle fixiert. Die Spezifikationen zu den Zahnriemen sind im Anhang unter Kapitel Zahnräder und Zahnriemen zu finden.

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Zahnriementrieb.png}
  \centering
  \caption{Zahnriementrieb}
  \label{fig:Zahnriementrieb}
\end{figure}

Die Zahnriemen, sind mithilfe eines Einlegestücks gespannt. Diese Methode zum Spannen der Zahnriemen wurde experimentell getestet. Es stellte sich heraus, dass die Spannung, die so erreicht werden kann, ausreicht.

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Zahnriemenspanner.png}
  \centering
  \caption{Methode zum Spannen der Zahnriemen}
  \label{fig:Methode zum Spannen}
\end{figure}

\newpage




\textbf{Akkugehäuse und Bordhalterung:} Der Akku, der die Energiequelle des Geräts ist, ist in einem Gehäuse direkt auf der Grundplatte montiert. Das Gehäuse für das Jetson-Bord ist auf dem Akkugehäuse befestigt. Für die Kühlung des Boards wird ein Ventilator verwendet, für dessen Montage ein Adapter konstruiert und gedruckt wurde.

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Gehäuse_Jetson_2.jpeg.jpg}
  \centering
  \caption{Akkugehäuse und Bordhalterung}
  \label{fig:Akkugehäuse und Bordhalterung}
\end{figure}

\newpage

\textbf{Kamera Aufbau:} Die Halterung für die Kamera und die Ultraschallsensoren, die sich oben im Gerät befinden, ist auf die Lagerböcke geschraubt. Die Komponenten der Halterung sind 3D-gedruckt. Die Kamera ist von innen an die Halterung geschraubt und die Ultraschallsensoren sind gesteckt. Weiter sind oben an dieser Halterung der Startknopf, der NOTAUS-Schalter und vier LED`s angebracht. Auf der Rückseite der Halterung sind die zwei H-Brücken angeschraubt.

\begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/Gerät Aufbau/KameraAufbau.JPG}
  \centering
  \caption{Kamera Aufbau}
  \label{fig:Kameraturnseite}
\end{figure}

\begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/Gerät Aufbau/KameraAufbau2.jpg}
  \centering
  \caption{H-Brücken an Kamera Aufbau}
  \label{fig:Kameraturmoben}
\end{figure}

\newpage

\textbf{Ultraschallsensorhalterung:} Der Ultraschallsensor, der sich vorne unten am Gerät befindet, ist in einer 3D-gedruckten Halterung an der Grundplatte angeschraubt.

\begin{figure}[H]
  \includegraphics[width=0.6\textwidth]{img/Gerät Aufbau/Usensorhalterung.png}
  \centering
  \caption{Ultraschallsensorhalterung}
  \label{fig:Uschallsensorhalterung}
\end{figure}

\textbf{Halbkugelstützen:} Die Halbkugelstützen erfüllen zwei Funktionen. Auf der einen Seite halten sie den Roboter gerade während der Fortbewegung, auf der anderen Seite geben die Stützen, welche auf Tastern montiert sind, das Signal für den Bodenkontakt.

\begin{figure}[H]
  \includegraphics[width=0.6\textwidth]{img/Gerät Aufbau/Halbkugel.png}
  \centering
  \caption{Halbkugelstütze}
  \label{fig:Halbkugelstütze}
\end{figure}

\newpage

\textbf{Haube:}

Das Gerät wird von einer Haube geschützt. Diese Haube lässt sich von oben über den Grundkörper schieben und wird mit Schrauben an die Grundplatte geschraubt. Die Haube wurde aus mehreren 3D-gedruckten dünnen Platten zusammengeklebt. So konnte die Haube dünn und leicht gebaut werden.

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/CADHaube.PNG}
  \centering
  \caption{CAD-Entwurf der Haube}
  \label{fig:Haube}
\end{figure}

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Gerät Aufbau/Haube.png}
  \centering
  \caption{Haube des Grundkörpers}
  \label{fig:Haube}
\end{figure}






\newpage

\subsection{Elektronikkomponenten}
\subsection{Pinbelegung}
Die Abbildung \ref{fig:pinout-jetson} zeigt die Pinbelegung des Jetson. Am Nvidia Jetson Nano sind folgende Komponenten angeschlossen:

\begin{itemize}
    \item ein \acrshort{i2c}-PWM-Board für die PWM-Signale für die H-Brücken 
    \item drei Ultraschallsensoren
    \item zwei Taster für den Grundkörper und ein Starttaster
    \item zwei H-Brücken für Fortbewegung/Treppensteigen
    \item zwei Encoder für je ein Motor der Fortbewegung
    \item vier LEDs für Bestätigung
\end{itemize} 

\begin{figure}[H]
  \includegraphics[width=0.8\textwidth]{img/Elektronik/pinout.png}
  \centering
  \caption{Pinbelegung des Jetson Nano}
  \label{fig:pinout-jetson}
\end{figure}


\newpage

\subsection{Taster}

Um zu erkennen, dass der Grundkörper auf der Treppe ist, werden zwei Mikrotaster verwendet, welche aktiv sind, sobald sie einen Untergrund berühren. Der erste Pin des Tasters ist mit einem GPIO-Pin des Jetson (Abb. \ref{fig:pinout-jetson}) und der zweite Pin ist mit Ground verbunden. Sobald der Taster aktiv ist, wird der GPIO-Pin des Jetson auf Ground gezogen. 

Der dritte Taster ist für das Startsignal verantwortlich. Dieser ist gleich angeschlossen, wie die Taster für den Grundkörper und startet den vorprogrammierten Bewegungsablauf.

\subsection{Motor für das Treppensteigen}
Der Motor für die Funktion des Treppensteigens wird an eine H-Brücke angeschlossen gemäss \ref{fig:hbrücke-treppe}. Drei weitere Pin der H-Brücke sind mit dem Jetson verbunden. Die Leitung ENA oder ENB übertragen das PWM-Signal, welches die Geschwindigkeit der Motoren steuert. Die Leitungen IN1/IN2 steuern den Links- oder Rechtslauf des Motors. Sind beide Leitungen auf Low, sind die Motoren aus. Ist eine Leitung auf High und die andere auf Low, dreht der Motor links oder rechts herum.

\begin{figure}[H]
  \includegraphics[width=0.4\textwidth]{img/Elektronik/h_brücke_motoren_treppensteigen.png}
  \centering
  \caption{Anschluss der Motoren an die H-Brücke}
  \label{fig:hbrücke-treppe}
\end{figure}

Dazu wurde ein GUI erstellt, um die Hubbewegung sowie die Drehung der Ausleger in einem ersten Versuch zu testen.

\begin{figure}[H]
  \includegraphics[width=0.6\textwidth]{img/Elektronik/gui_motoren.png}
  \centering
  \caption{GUI Motorensteuerung}
  \label{fig:gui-motoren}
\end{figure}

\newpage

\subsection{Motoren für Fortbewegung}
Für die Fortbewegung werden 12V DC Getriebemotoren mit Encoder und abgewinkelter Ausgangswelle gewählt \cite{Motoren-Fortbewegung}. Die Motoren werden gleich wie die Motoren der Hubbewegung an eine weitere H-Brücke angeschlossen (Abb. \ref{fig:hbrücke-treppe}).
Um zu Beginn mit dem Roboter für erste Tests vorwärts und rückwärts fahren zu können wurde im zuvor erstellten GUI jeweils ein Button für vor-/rückwärts hinzugefügt.

\begin{figure}[H]
  \includegraphics[width=0.6\textwidth]{img/Elektronik/h_brücke_motoren_fortbewegung.png}
  \centering
  \caption{Anschluss der Motoren an die H-Brücke für Fortbewegung}
  \label{fig:hbrücke-fortbeweg}
\end{figure}

\subsubsection{Encoder}
Encoder oder auch Winkelmesser sind in der Lage, den vorangeschrittenen Winkel bei einer Drehung des Motors zu bestimmen. Mit dieser Winkelangabe und dem Umfang des Rades kann somit die theoretisch gefahrene Distanz bestimmt werden. Die Gefahr dabei ist, dass ein Durchdrehen des Rades in der Software fälschlicherweise als zurückgelegte Distanz aufgenommen werden kann, weshalb der Encoder nicht alleine für die Orientierung verwendet wird sondern von der Kamera unterstützt wird.

\begin{figure}[h]
  \includegraphics[width=0.7\textwidth]{img/Elektronik/quadrature.png}
  \centering
  \caption{Encoder Signal Kanal A und B}
  \label{fig:encoder-sig}
\end{figure}

Der Encoder gibt bei einer Umdrehung des Motors Rechteckpulse zurück. Durch das Zählen der Pulse in Kanal A und B in einem fixen Zeitintervall und der Anzahl der Pulse pro Umdrehung kann die Geschwindigkeit in rpm wie folgt berechnet werden:

\begin{align}
    Geschwindigkeit\ [rpm] = \frac{\frac{Encoder\ Ticks}{Ticks\ pro\ Umdrehung} \cdot 60\ s}{Zeitintervall\ [s]}
\end{align}

Der Weg kann mittels Umfang des Rades ermittelt werden und in Anzahl Encoder Pulse umgerechnet werden.

\begin{align}
    Anzahl\ Ticks = \frac{Distanz\ [cm]}{Umfang\ Rad\ [cm]} \cdot Ticks\ pro\ Umdrehung
\end{align}

Für beispielsweise eine 90\textdegree-Drehung kann ein Rad vorwärts und das andere Rad rückwärts angesteuert werden, bis die benötigte Distanz erreicht wurde. 


\subsection{Ultraschallsensor}

Ultraschallsensoren sind gut, um ein breites Feld nach Gegenständen abzusuchen. Die Ungenauigkeit von +-5mm, welche in Tests nachgewiesen werden konnte ist dabei vernachlässigbar, da diese Sensoren in erster Linie zur Unterstützung und besseren Einschätzung der Lage dienen.
Im Roboter wird ein solcher Sensoren in Fahrtrichtung nach vorne verbaut. Der Sensor wird verwendet, um die Kamera bei der Orientierung und vorallem dem Ausweichen von Hindernissen beim Traversieren auf der Treppe zu unterstützen.

\subsection{Akku}
Im \acrshort{pren1} wurde bereits eine Theoretische Berechnung für die Auslegung des Akkus gemacht. Um eine höhere Genauigkeit für die Kapazität zu erzielen, werden die elektronischen Komponenten wie z.B. die Motoren angesteuert und der Stromverbrauch mittels Multimeter gemessen:
\begin{itemize}
    \item Hauptmotor Hubbewegung: 0.65 A
    \item Hilfsmotor Hubbewegung: 0.35 A
    \item Motoren Fortbewegung: 2 \cdot\ 0.25 A
    \item Jetson Nano: 0.9 A
\end{itemize}
Daraus folgt 
\[C = {I\cdot t} = \frac{2.4\ A\cdot 12\ min}{60} \cdot 1000 = 480\ mAh\]
Mit Faktor 4 als Reserve ergibt sich ein Modellbauakku mit ca. 2300 mAh von Tattu \cite{Akku-Modellbau}. Diese Kapazität wurde gewählt, damit der Roboter auch für längere Zeit mit Strom versorgt wird. Dies ist von Vorteil beim Entwickeln und Testen des Roboters. Dadruch können mehrere Testläufe hintereinander durchführt werden, ohne den Akku immer wieder laden zu müssen.

Ergänzend zu erwähnen ist, dass diese Berechnung vor dem Entfernen des zweiten Hubbewegungsmotors gemacht wurde, wodurch die bereits vorhandene Reserve erweitert wird.

\newpage
\subsection{Schema}
\begin{figure}[h]
  \includegraphics[width=0.7\textwidth]{img/Elektronik/schema.png}
  \centering
  \caption{Schema der Elektronikkomponenten des Roboters}
  \label{fig:schema}
\end{figure}

Nachfolgend werden die Elektronikkomponenten, welche noch nicht näher erläutert wurden, kurz beschrieben.

\textbf{DC-DC-Converter:} Der DC-DC-Converter wandelt eine Eingangsspannung von ca. 13 V - 16.6 V in eine konstante Spannungsversorgung von 5 V für beispielsweise das Jetson Nano, Sensoren, etc. um. Dieser wurde gewählt, da er kostengünstig ist. Die Ausgangsspannung kann mittels Potentiometer eingestellt werden. Diese wird auf ca. 5.1 V eingestellt, damit falls die Belastung steigt und die Spannung leicht einbricht, immer mindestens 5 V anliegen. 

\textbf{Spannungsanzeige:} Die Spannungsanzeige ist eine 7-Segmentanzeige mit drei Ziffern. Diese Anzeige ist am Akku angeschlossen und damit kann der Ladezustand des Akkus überprüft werden. Fällt die Spannung unter 13 V sollte der Akku aufgeladen werden.

\textbf{Akku:} Der Akku ist ein vier Zellen LiPo-Akku mit einer Kapazität von 2300 mAh. Dieser versorgt die Bauteile des Robotors mit Spannung. Ist der Akku voll geladen, liefert er eine Spannung von ca. 16.6 V. Diese Spannung sollte nie unter 12 V fallen, bzw. eine Zelle nie unter 3 V, da sonst die Zellen beschädigt werden und der Akku verliert an Kapazität.

\textbf{LED:} Die LEDs haben die Aufgabe, das Erkennen des Piktogramms zu signalisieren. Die vier LEDs werden gleichzeitig durch das Jetson Nano über einen NPN-Transistor, welcher als Schalter dient, angesteuert. Die Spannung über den LEDs wird über die Vorwiderstände eingestellt und der Widerstand an der Basis des Transistors begrenzt den Strom zwischen Transistor und Ausgang des Jetson Nano.

\textbf{PWM-Treiber}: Das PWM-Treiber-Board generiert durch den PCA9685 Controller PWM-Signale, welche für die H-Brücken der Motoren zur Steuerung der Geschwindigkeit benötigt werden. Die Befehle für z.B. den Duty-Cylce eines PWM-Signals wird von Jetson Nano mittels \acrshort{i2c} auf den Controller übertragen. Dieses wurde gewählt, weil das Jetson Nano Board nur zwei Hardware-PWM-Ausgänge hat. Benötigt werden jedoch drei (zwei Fortbewegungsmotoren und ein Hubmotor).

\textbf{Ultraschallsensoren:} Die Ultraschallsensoren messen eine Distanz. Dabei wird ein Trigger-Signal zum Sensor geschickt und dabei eine Zeitmessung gestartet. Sind die Ultraschallwellen wieder zurück, geht das Echo-Signal auf High und die Zeit wird gestoppt. Die Distanz kann durch folgende Formel berechnet werden:
\begin{align}
    Distanz\ [m] = \frac{Zeit\ [s] \cdot 34300\ [\frac{cm}{s}]}{2}
\end{align}
Die gemessene Zeit wird mit der Schallgeschwindigkeit multipliziert und durch zwei geteilt, da die Ultraschallwellen hin und zurück ausgebreitet hat. 
Das Echo-Signal vom Sensor weg muss zudem durch einen Spannungsteiler mit zwei Widerständen auf 3.3 V begrenzt werden, da die Pins des Jetson Nano nur bis maximal 3.3 V ausgelegt sind. Übersteigt die Eingangsspannung des Pins diese 3.3 V, kann das Jetson Nano beschädigt werden.



\newpage

\section{Standsicherheit beim Erklimmen einer Stufe}

Beim Erklimmen einer Stufe ist der kritische Fall, wenn sich die Ausleger horizontal auf einer Linie mit dem Grundkörper befinden. Wenn der Grundkörper auf die nächste Stufe gehoben wird befindet sich die Drehachse der Ausleger am Grundkörper über der Kante der Stufe (siehe Abbildung \ref{fig:Erklimmen}).

\begin{figure}[h]
  \includegraphics[width=\textwidth]{img/Gerät Aufbau/Standsicherheit.png}
  \centering
  \caption{Gerät beim Erklimmen einer Stufe}
  \label{fig:Erklimmen}
\end{figure}

Um die Standsicherheit in diesem Fall berechnen zu können, wurde das Gewicht des Grundkörpers und der verbundenen Ausleger einzeln gewogen und der Schwerpunkt ermittelt.\\

Gewicht Grundkörper: $m_{GK}$ = 2.63 kg

Gewicht Ausleger: $m_{A}$ = 0.436 kg\\

Abstand Schwerpunkt Grundkörper zur Drehachse: b = 52 mm

Abstand Schwerpunkt Ausleger zur Drehachse: a = 190 mm

\newpage

\begin{align*}
M_{Kipp} = m_{A} \cdot g \cdot a = 0.436\ kg \cdot 9.81\ \frac{m}{s^2} \cdot 190\ mm = 0.81\ Nm
\end{align*}

\begin{align*}
M_{Stand} = m_{GK} \cdot g \cdot a = 2.63\ kg \cdot 9.81\ \frac{m}{s^2} \cdot 52\ mm = 1.34\ Nm
\end{align*}\\

Daraus folgt: $M_{Stand}$ > $M_{Kipp}$

\begin{align*}
Standsicherheit = \frac{M_{Stand}}{M_{Kipp}} = \frac{1.34\ Nm}{0.81\ Nm} = \underline{\underline{1.65}}
\end{align*}







\newpage

\section{Testing}

\subsection{Manuelles Testing}
Für die allerersten Tests der Motorenansteuerung, wurde das GUI zur Hilfe genommen, welches in \acrshort{pren1} entwickelt wurde. Kurz daraufhin sollten die ersten Softwarekomponenten (\texttt{LiftingController}, \texttt{AlignmentChecker}, \texttt{CruisingController}) getestet werden. Dies wurde in einem ersten Durchlauf mithilfe des interaktiven Python Modus in der Konsole erreicht. Daraufhin wurde jedoch eine Fernbedienung geschrieben. Mehr dazu im Abschnitt \ref{subsec:Fernbedienung}.

\textbf{Hubbewegung:}

\textbf{Ablauf:}

Um den ersten Sprint erfolgreich abzuschliessen, wurden alle Teile, welche bereits in \acrshort{pren1} konstruiert wurden, mit den 3D-Druckern im Team produziert. Die Elektromotoren, welche für die Hubbewegung zuständig sind, wurden verbaut, ebenso die Motoren für die Fortbewegung um das Gewicht realistischer zu simulieren. Somit konnten die Hubbewegungen getestet werden und das 3D-Konstrukt auf Schwachstellen untersucht werden.

\begin{figure}[H]
  \includegraphics[width=0.7\textwidth]{img/Sprint1/pren1_sprint1_1.png}
  \centering
  \caption{Sprint 1 - Erste Prototypentests}
  \label{fig:erstePrototypentests}
\end{figure}

\newpage

In diesem Test offenbarte sich eine Schwachstelle. Das Motorrizel des Hubmotors konnte die Drehbewegung des Motors nicht aufnehmen, was zu einem Durchdrehen des Motors geführt hat.
Diese Schwachstelle des ersten Prototypen konnte schnell verbessert  werden, was zu einem schnellen, erfolgreichen zweiten Versuch führte.

\begin{figure}[H]
  \includegraphics[width=0.7\textwidth]{img/Sprint1/pren1_sprint1_2.png}
  \centering
  \caption{Sprint 1 - Zweite Tests}
  \label{fig:zweiteTests}
\end{figure}

Mit den Verbesserungen war es möglich, die erste und die zweite Hubbewegung ohne Überbelastung einzelner Teile durchzuführen.
Die volle Drehbarkeit der Ausleger wird nur noch von den Stromkabeln an den Motoren eingeschränkt. In einem zweiten Test wurden wiederum neu angekommene Teile direkt verbaut um langsam an das Zielgewicht heranzukommen.

Mit diesem Roboter konnten auch die ersten Versuche auf einer Treppe durchgeführt werden (siehe Abbildung \ref{fig:ersteTreppentests}). Dazu wurde der Roboter in verschiedenen Positionen auf der Treppe platziert und die erste Hubbewegung ausgeführt.

\begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/Sprint1/pren1_sprint1_3.png}
  \centering
  \caption{Sprint 1 - Erste Treppentest}
  \label{fig:ersteTreppentests}
\end{figure}

Bei diesem Test konnte einiges über die Form der Ausleger und dessen Optimierungspotential gelernt werden.

Ein weiterer Punkt für Optimierungen sind die beiden Wellen die durch den Grundkörper verlaufen. Das Grundgerüst bestehend aus 3D-Druck Teilen erfüllt seinen Zweck vollumfänglich. Die 3D-gedruckten Wellen wurden durch Wellen aus Aluminium ausgetauscht. Dies, weil die Achsen für die Struktur von entscheidender Bedeutung sind. 

\textbf{Ergebnisse:}

Der erste Sprint und somit die ersten Prototypentests haben Schwachstellen und Potential enthüllt. Das Konzept, das im \acrshort{pren1} erarbeitet wurde, ist umsetzbar. Es benötigt noch Optimierungen, um das volle Potential auszuschöpfen. Die Optimierungen wurden fortlaufend, neben dem Implementieren neuer Funktionen, umgesetzt.

\textbf{Fortbewegung:}

Die Fortbewegung soll möglichst auf engem Raum stattfinden können. Deshalb wurden in diesem Bereich zwei mögliche Drehmethoden getestet. Die einfachere der beiden ist das vor oder rückwärts drehen eines einzelnen Rades. Die etwas aufwändigere Methode ist das vor oder rückwärts drehen eines Rades während das andere Rad in die entgegengesetzte Richtung dreht.

Nach diesem Test hat sich ergeben, dass die zweite Variante mit dem ansteuern beider Motoren in unterschiedliche Richtungen eine Drehung nahezu auf einer Stelle gewährleistet. Somit wurde in der Software diese Art der Drehung implementiert.

\subsection{Testing mit Software}\label{subsec:Fernbedienung}
Um die einzelnen Verhalten des Roboters, wie z.B. Hubbewegung, Ausrichtung zur Treppe, Fortbewegung, 90\textdegree-Drehungen effizient testen zu können, wurde eine Fernbedienung über SSH entwickelt. Mithilfe dieser Fernbedienung ist es möglich, den Roboter über die Tastatur des Notebooks zu steuern. Mit dem Notebook muss man sich lediglich per SSH auf das Controllerboard mit dem embedded Linux verbinden und das Python-Modul \texttt{remote\_control\_ssh.py} starten. Hierbei war die Schwierigkeit, dass Keyboard Inputs über SSH nicht direkt eingelesen werden können, wie das bei einer Tastatur welche direkt mit dem Controllerboard verbunden ist, der Fall ist. Dies aus dem Grund, dass Keyboardinputs nicht standardmässig über SSH übertragen werden. 

Dieses Problem konnte umgangen werden, indem man auf dem Notebook ein X-Server \cite{Wikipedia-X-Window-System} startet und die SSH Verbindung mit einem X11-Forwarding startet. Das \texttt{remote\_control\_ssh.py} Modul startet dann ein Window auf dem X-Server welcher auf dem Notebook gestartet wurde. Die Keyboard Inputs werden dann über die X-Session an das Controllerboard übertragen. 

Als X-Server wurde der Xming X Server für Windows verwendet \cite{Xming-X-Window-Server-Download}.

Das X11-Forwarding bei der SSH Verbindung kann im Putty unter Connection/ssh/x11 enabled werden. 

\begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/remote_control/putty_x11.PNG}
  \centering
  \caption{Putty X11-Forwarding}
  \label{fig:putty_x11_forwarding}
\end{figure}

\newpage

Bie einer SSH Verbindung aus der Konsole fügt man lediglich den Parameter -X (gross X) hinzu. Der Befehl könnte dann folgendermassen aussehen: \texttt{ssh -X raspi\_hslu}.

Die Bedienung wurde folgendermassen festgelegt:
\begin{center}
\begin{table}[H]
\begin{tabular}{|l|r|r|r|r|}
\hline
\textbf{Kommando} & \textbf{Tastaturbelegung} &
\textbf{Keycode}\\
\hline
Forward & W & 119\\
\hline
Backward & S & 115\\
\hline
Turn left & A & 97\\
\hline
Turn right & D & 100\\
\hline
Stop cruise & Q & 113\\
\hline
Main Motor Forward & E & 101\\ 
\hline
Main Motor Backward & R & 114\\ 
\hline
Main Stop & X & 120\\ 
\hline
Turn right 90 & F & 102\\ 
\hline
Turn left 90 & G & 101\\ 
\hline
Approach stair & 1 & 49\\ 
\hline
Align & 2 & 50\\ 
\hline
Climb step & 3 & 51\\ 
\hline
Tof distance & 4 & 52\\ 
\hline
Straight forward 50cm & c & 99\\ 
\hline
Emergency stop & [space] & 32\\ 
\hline
Quit & [esc] & 27\\ 
\hline
\end{tabular}
\caption[Tastaturbelegung für die Fernsteuerung]{Tastaturbelegung für die Fernsteuerung}
\label{tab:entwicklungsaufwand}
\end{table}
\end{center}


\subsection{Fortbewegung}

Die Fähigkeit, geradeaus zu fahren ist unter anderem für das Traversieren auf der Treppe von grosser Bedeutung, weshalb die Winkelmotoren der Fortbewegung spezifisch mit Encoder gewählt wurden. Mithilfe dieser Encoder können die Motoren so gesteuert werden, dass die Räder immer gleich schnell drehen. Dies wird in einer eigenen Klasse implementiert. Ebenfalls wird ein Modul programmiert, welches nach Eingabe eines Gradwertes eine möglichst genaue Drehung gewährleistet.

\begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/Sprint3/fortbewegung.jpg}
  \centering
  \caption{Fortbewegungstests}
  \label{fig:Fortbewegungstests}
\end{figure}
In diesen Tests konnte festgestellt werden, dass aufgrund von dem geringen Schlupf zwischen dem Motor und den Rädern eine leichte Abweichung nicht umgangen werden kann. Dieser beläuft sich jedoch auf wenige Millimeter auf eine Fahrdistanz von 0.5 Meter. Somit kann ein zuverlässiges Geradeausfahren sichergestellt werden.

Die Drehung um die eigene Achse ist ein Punkt, bei welchem es viele Lösungsmöglichkeiten gibt. Das Ziel ist es, eine Drehung auf möglichst kleinem Raum zu ermöglichen. Dabei können die Räder verschieden schnell angesteuert werden um die Drehung zu optimieren. In den Tests hat sich ergeben, dass die Räder bereits in der Planung sehr gut plaziert wurden, weshalb die Räder gleichmässig angetrieben werden können ohne den Radius signifikant zu vergrössern.



\subsection{Autonome Hubbewegung}

Der nächste Schritt ist die automatisierung der Hubbewegung. Dazu werden weitere Komponenten im Grundgerüst verbaut und verkabelt. Dazu gehören neben den Motoren für die Hubbewegung auch die H-Brücken dieser Motoren. Ebenfalls werden bereits die Fortbewegungsmotoren mit der dafür vorgesehehenen H-Brücke verbunden. Weiter werden die Taster und der Schalter ausgemessen und Kabel angelötet um später Zeit einzusparen. Der Akku wird noch nicht verbaut aufgrund einer Lieferverzögerung, weshalb der erste Test auch noch mit einem Kabel zur Stromversorgung verwendet. Gesteuert wird der Roboter in diesem Versuch von einem Raspberry Pi 3B.
Auch wenn das Raspberry nicht der finale Controller des Roboters ist, können somit die in Python geschriebenen Funktionen getestet und verfeinert werden.
Das Ziel dieses Tests ist es, eine automatisierte, über den Controller gesteuerte Hubbewegung.

Dazu werden die ersten Tests auf einem Tisch durchgeführt und der Roboter manuell abgefangen bevor der erste Treppentest durchgeführt wird.

\begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/Sprint2/pren2-Löten.jpg}
  \centering
  \caption{Verkabelung der Elektronikkomponenten}
  \label{fig:sprint-backlog-1}
\end{figure}

Zu Beginn werden alle Komponenten des Roboters einzeln über den Controller angesteuert und getestet, wie sich diese verhalten. Dabei fällt auf, dass die menschliche Reaktionszeit der beschränkende Faktor ist beim Erklimmen der Treppe. Eine Hubbewegung ist möglich aber nur sehr langsam. Um die Hubbewegung vollkommen autonom gewährleisten zu können werden die einzelnen Module in Verhalten eingeteilt welche eine Aufgabe erledigen und dazu die Module eigenständig verwendet.



\subsection{Anfahren der Treppe}

Um an die Treppe heranfahren und sich ausrichten zu können, werden die Module der Fortbewegung in Kombination mit den beiden TOF-Sensoren benötigt, welche auf Höhe der Treppenkante montiert sind. Die Sensoren liefern dabei nicht nur die Werte für die Distanz zur Treppe sondern auch die Ausrichtung zur Treppe. Ist der Abstand zur Treppe wie gewünscht, stoppt das Gerät und dreht sich noch soweit um die eigene Achse, bis der Distanzunterschied beider Sensoren im vorbestimmten Toleranzbereich ist und der Roboter somit für die nächste Hubbewegung bereit ist.
Der Controller startet das Verhalten zum Anfahren und Ausrichten zur Treppe, welches wiederum die programmierten Module verwendet. Dieser Aufbau der Software ermöglicht ein sehr flexibles Vorgehen und eine gute Überschaubarkeit des Codes.

\begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/Sprint2/pren2_ausrichten-anfahren.jpg}
  \centering
  \caption{Roboter beim Test zur automatischen Ausrichtung}
  \label{fig:sprint-backlog-1}
  \end{figure}
  
  
\subsection{Bilderkennung}

Um den Pfad zu berechnen müssen die Gegenstände auf der Treppe gefunden werden. Dazu wird eine Datenbank mit möglichst vielen Bildern gesammelt, auf welchen die Ziegelsteine manuell eingezeichnet werden. Die Datenbank umfasst ungefähr 420 Bildern und ermöglicht dem Computer somit eine zuverlässige Vergleichsbasis, um die Hindernisse selbstständig zu finden.

Diese Bilder werden mit einem Mock-Up und einer selber entwickelten App gemacht, um einerseits die Kamera auf der richtigen Höhe zu fixieren und andererseits, um die Handhabung zu vereinfachen.



\begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/Sprint3/Sprint3_Bildersammlung.jpeg}
  \centering
  \caption{Vorgehen zur Aufnahme der Referenzbilder}
  \label{fig:Aufnahme der Referenzbilder}
  \end{figure}
  
  Zusätzlich werden Bilder für die Piktogrammerkennung im Start- und Zielbereich gemacht. Dies wiederum, um den bereits erstellten Piktogrammerkennungsalgorithmus zu testen und zu verfeinern.
  
  
  \begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/Sprint3/Sprint3_Bildersammlung2.jpeg}
  \centering
  \caption{Das Team bei der Aufnahme der Referenzbilder}
  \label{fig:Aufnahmeprozess der Referenzbilder}
  \end{figure}
  
  
\subsection{Funktionsweise mit Akku}\label{sec:Funktionsweisemit Akku}

Um ein autonomes Fahren gewährleisten zu können, muss der Roboter mit einem Akku betrieben werden können. Dazu werden verschiedene Schritte benötigt. Ausserdem wird erstmals das Jetson Nano verwendet.

 \begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/Sprint3/Sprint3_Verkabelung1.jpg}
  \centering
  \caption{Rückansicht der ersten Verkabelung mit Akku}
  \label{fig:Rückansicht der ersten Verkabelung}
  \end{figure}
  
  
  In einem ersten Schritt werden die zwei Spannungslevel hergestellt. Der Akku liefert 16 Volt, welche für alle Motoren verwendet werden. Mithilfe des Wandlers wird das zweite Niveau von 5 Volt erreicht, welches neben dem Jetson auch sämtliche Sensoren unabhängig des Controllers mit Strom versorgt. So kann das Jetson den zur Verfügung gestellten Strom für die volle Leistung verwenden.
  Die Verkabelung sämtlicher Elemente ist provisorisch. Geplant ist, dass das Kabelmanagement nach Abschluss der Funktionskontrolle aller Elemente verbessert wird, um zu einem späteren Zeitpunkt einen besseren Überblick zu gewährleisten.
  
   \begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/Sprint3/Sprint3_Verkabelung2.jpg}
  \centering
  \caption{Seitenansicht der ersten Verkabelung mit Akku}
  \label{fig:Seitenansicht der ersten Verkabelung}
  \end{figure}
  
  Der Notschalter der fertigen Konstruktion schaltet wie geplant nur die H-Brücken der Motoren. Die 5 Volt Spannungsverteilung wird vom Schalter nicht tangiert. Dies um zu umgehen, dass das Jetson Nano ohne korrektes Herunterfahren abgeschaltet wird.
  
  Zusätzlich wurde auch ein Motor zur Hubbewegung entfernt und der Motor, welcher zuständig für die erste Hubbewegung ist, wurde weiter nach vorne verlagert. So kann der Schwerpunkt nach vorne verschoben werden.
Die Welle des entfernten Motors wird wieder mit einer 3D gedruckten Welle ersetzt um wiederum Gewicht zu sparen. Diese Welle wird korrekt eingestellt und dann fixiert, da die Standsicherheit gegeben ist und das Einklappen der Standfüsse nicht mehr benötigt wird.
  
Ergebnisse: Mithilfe der Gewichtsreduktion kann die Hubbewegung schneller und einfacher durchgeführt werden. Das Pathfinding wurde mithilfe der über 300 Referenzbilder trainiert und liefert überzeugende Ergebnisse.
 
 \subsection{Einbindung des Jetson Controller}

 Um das Jetson einbinden zu können, müssen die Module der Software auf die Jetson-Libraries umgeschrieben werden. Dazu werden die Module der State-Machine auf eine GPIO-Library, welche vom Jetson unterstützt wird, reduziert. Da das Jetson kein eingebundenes WLAN-Modul besitzt, werden für die Tests ein externes WLAN Modul eingebunden um den Roboter weiterhin remote steuern und updaten zu können.
 
 Zusätzlich wird ein externer PWM Verteiler verwendet, da das Jetson nur über zwei PWM Ausgänge verfügt. Somit können alle Motoren über Hardware-PWM Pins angesteuert werden als im Vergleich zum Raspberry Pi über Software PWMs. 
 
 
 \subsection{Modultests auf Originaltreppe}

Um die Module korrekt testen zu können, werden Tests auf der Originaltreppe im Aussenbereich durchgeführt. Dies um in erster Linie den Einfluss verschiedenen Lichtverhältnisse auf die Kamera und die Sensoren zu überprüfen. In diesen Tests konnte auch erstmals das optimierte Pfadfindungsmodul auf der entscheidenden Treppe gemacht werden.

   \begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/pren2_tests_treppe.jpeg}
  \centering
  \caption{Pfadfindungtests auf Originaltreppe}
  \label{fig:Tests auf Originaltreppe}
  \end{figure}
  
  Bei diesen Tests hat sich auch gezeigt, dass die TOF-Sensoren auf der leicht reflektierenden Treppe eine grosse Ungenauigkeit aufweisen. Bei den Versuchen wurde eine Messgenauigkeit von +-10cm ersichtlich. Aus diesem Grund wurden die Time of Flight Sensoren mit Ultraschallsensoren ersetzt. Dies ist verhältnissmässig einfach gelungen, da bereits der Code für alle Funktionen in anderen Modulen vorhanden ist und direkt in das TOF-Modul hineinkopiert werden konnte.
  
  Da die Flugzeit der Ultraschallsensoren jedoch selber berechnet werden muss und wir uns auf einem nicht Realtime System 
  befinden\footnote{\url{https://en.wikipedia.org/wiki/Real-time_operating_system}}, haben auch diese eine gewisse Messungenauigkeit.
  Um diese Ungenauigkeit zu minimieren, wurde die Berechnung vom Python Programm in ein Kernelmodul\footnote{
    \url{https://github.com/johannesthoma/linux-hc-sro4}
  } verlagert, dies gibt wesentlich genauere Messdaten zurück.
  
 Somit ist folgend der Roboter mit der finalen Hardware dargestellt.
 
    \begin{figure}[H]
  \includegraphics[width=0.65\textwidth]{img/pren2_tests_treppe.jpeg}
  \centering
  \caption{Pfadfindungtests auf Originaltreppe}
  \label{fig:Tests auf Originaltreppe}
  \end{figure}
 
 
  
  
  
  
  
  
  
  
  





  